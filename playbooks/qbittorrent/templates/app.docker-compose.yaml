---
services:
  qbittorrent:
    container_name: qbittorrent
    image: lscr.io/linuxserver/qbittorrent:latest
    environment:
      PUID: {{ nfs_user_id }}
      PGID: {{ qbit_media_group_gid }}
      TZ: {{ debian_datetime_timezone }}
      UMASK: 007
    volumes:
      - {{ nfs_mounts.marilyn.mount_point }}/configs/qbittorrent:/config
      - {{ nfs_mounts.marilyn.mount_point }}/torrents:/data/torrents
      - {{ nfs_mounts.marilyn.mount_point }}/media/cross-seed-links:/data/media/cross-seed-links
    ports:
      - 8080:8080
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -s -o /dev/null -f http://localhost:8080"]
      interval: 2s
      timeout: 30s

  cross-seed:
    container_name: cross-seed
    image: ghcr.io/cross-seed/cross-seed:latest
    volumes:
      - {{ nfs_mounts.marilyn.mount_point }}/configs/cross-seed:/config
      - {{ nfs_mounts.marilyn.mount_point }}/configs/qbittorrent/qBittorrent/BT_backup:/torrents:ro
      - {{ nfs_mounts.marilyn.mount_point }}/torrents/cross-seed-torrents:/cross-seeds
      - {{ nfs_mounts.marilyn.mount_point }}/media:/data/media
    command: daemon
    ports:
      - "2468:2468"
    user: {{ nfs_user_id }}:{{ qbit_media_group_gid }}
    restart: unless-stopped
    depends_on:
      qbittorrent:
        condition: service_healthy

  qbit-manage:
    container_name: qbit-manage
    image: ghcr.io/stuffanthings/qbit_manage:latest
    volumes:
      - ./qbit-manage.config.yaml:/app/config.yml
      - {{ nfs_mounts.marilyn.mount_point }}/torrents:/data/torrents
      - {{ nfs_mounts.marilyn.mount_point }}/configs/qbittorrent/qBittorrent:/qbittorrent/:ro
    environment:
      QBT_RUN: false
      QBT_SCHEDULE: 1440
      QBT_CONFIG: config.yml
      QBT_LOGFILE: activity.log
      QBT_LOG_LEVEL: INFO
    restart: unless-stopped
    depends_on:
      qbittorrent:
        condition: service_healthy
